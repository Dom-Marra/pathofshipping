<form [formGroup]="itemForm">
    <mat-expansion-panel [expanded]="'true'">

        <mat-expansion-panel-header>
            <mat-panel-title>
                <div class="item-delete" (click)="$event.stopImmediatePropagation(); remove()">
                    <i-feather name="trash-2"></i-feather>
                </div>
            </mat-panel-title>
            <div *ngIf="!this.getEditName()" class="item-name" 
                (click)="$event.stopImmediatePropagation(); this.setEditName(true)" 
                role="button" aria-label="Edit item name">
                <p>{{itemForm.value.itemName}}</p>
                <i-feather name="edit-2"></i-feather>
            </div>
            <mat-form-field *ngIf="this.getEditName()" [floatLabel]="'never'" (click)="$event.stopImmediatePropagation();" >
                <input #itemNameInput matInput 
                    (keydown.Space)="$event.stopImmediatePropagation()" 
                    (keydown.enter)="$event.stopImmediatePropagation(); $event.target.blur()"
                    (blur)="this.setEditName(false)" type="text" autocomplete="off" placeholder="Item Name"  formControlName="itemName">
            </mat-form-field>
        </mat-expansion-panel-header>

        <div class="item-contents">
            <div id="item-type-fields" class="field-wrapper">
                <mat-form-field id="search-field">
                    <mat-label>Search Items</mat-label>
                    <input matInput type="text" autocomplete="off" [matAutocomplete]="searchableItems" formControlName="itemSearch">
                    <button mat-button *ngIf="this.itemForm.value.itemSearch != ''" matSuffix mat-icon-button aria-label="Clear" (click)="this.itemForm.patchValue({'itemSearch': ''})">
                        <i-feather name="X" class="feather-suffix"></i-feather>
                    </button>

                    <mat-autocomplete #searchableItems="matAutocomplete" [class]="'autocomplete-panel'">
                        <mat-optgroup *ngFor="let search of getFilteredItems() | async" [label]="search.category">
                            <mat-option *ngFor="let item of search.items | slice:0:25;" [value]="item">
                                {{item}}
                            </mat-option>
                        </mat-optgroup>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-form-field id="type-field">
                    <mat-label>Item Type</mat-label>
                    <input #itemTypesInput matInput type="text"  autocomplete="off" 
                            [matAutocomplete]="searchableItemTypes" 
                            [placeholder]="itemForm.value.itemCategory"
                            (input)="filteredTypes = filterEnums($event.target.value, this.ITEM_TYPES)"
                            [matAutocompletePosition]="'below'"
                            [value]="itemForm.value.itemCategory"
                            (focus)="$event.target.value = ''; filteredTypes = filterEnums('', this.ITEM_TYPES)"
                            (blur)="$event.target.value = itemForm.value.itemCategory">

                    <mat-autocomplete #searchableItemTypes="matAutocomplete" 
                                    [class]="'autocomplete-panel'" 
                                    autoActiveFirstOption="'true'"
                                    (optionSelected)="itemForm.controls.itemCategory.patchValue($event.option.value); itemTypesInput.blur()">
                        <mat-option *ngFor="let type of filteredTypes" [class.mat-selected]="type == itemForm.value.itemCategory" [value]="type">
                            {{type}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <mat-form-field id="rarity-field">
                    <mat-label>Item Rarity</mat-label>
                    <input #itemRaritiesInput matInput type="text"  autocomplete="off" 
                            [matAutocomplete]="searchableItemRarities" 
                            [placeholder]="itemForm.value.itemRarity"
                            (input)="filteredRarities = filterEnums($event.target.value, ITEM_RARITIES)"
                            [matAutocompletePosition]="'below'"
                            [value]="itemForm.value.itemRarity"
                            (focus)="$event.target.value = ''; filteredRarities = filterEnums('', ITEM_RARITIES)"
                            (blur)="$event.target.value = itemForm.value.itemRarity">

                    <mat-autocomplete #searchableItemRarities="matAutocomplete" 
                                    [class]="'autocomplete-panel'" 
                                    autoActiveFirstOption="'true'"
                                    (optionSelected)="itemForm.controls.itemRarity.patchValue($event.option.value); itemRaritiesInput.blur()">
                        <mat-option *ngFor="let rarity of filteredRarities" [class.mat-selected]="rarity == itemForm.value.itemRarity" [value]="rarity">
                            {{rarity}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <mat-expansion-panel class="sub-item-expansion">
                <mat-expansion-panel-header>
                        Weapon Filters
                </mat-expansion-panel-header>
                <div class="item-contents">
                    <div id="item-type-fields" class="field-wrapper">
                        <mat-form-field>
                            <mat-label>Placeholder</mat-label>
                            <input matInput type="text" autocomplete="off">
                        </mat-form-field>
                    </div>
                </div>
            </mat-expansion-panel>
        </div>
    </mat-expansion-panel>
</form>

